version: 0.1.0
type: oiml.intent
ai_context:
  purpose: |
    Create a Shopify clone e-commerce application with all core entities and APIs
    for a first version including products, variants, categories, customers, orders, and cart functionality.
  instructions: |
    - Read .oiml/AGENTS.md and apply the instructions to the intent.
    - Follow Prisma implementation guide for field mappings and relations.
    - Follow Next.js API implementation guide for endpoint creation.
    - Ensure all entities have proper timestamps (created_at, updated_at).
    - Use UUID for primary keys where appropriate.
    - Include proper foreign key relationships.
  references:
    - kind: file
      path: .oiml/AGENTS.md
provenance:
  created_by:
    type: human
    name: ""
  created_at: 2025-01-27T00:00:00Z

intents:
  # ============================================
  # PRODUCT ENTITIES
  # ============================================

  - kind: add_entity
    scope: data
    entity: Category
    fields:
      - name: id
        type: uuid
        required: true
      - name: name
        type: string
        max_length: 255
        required: true
        unique: true
      - name: slug
        type: string
        max_length: 255
        required: true
        unique: true
      - name: description
        type: text
        required: false
      - name: image_url
        type: string
        max_length: 500
        required: false
      - name: created_at
        type: datetime
        required: true
        default: now
      - name: updated_at
        type: datetime
        required: true

  - kind: add_entity
    scope: data
    entity: Product
    fields:
      - name: id
        type: uuid
        required: true
      - name: title
        type: string
        max_length: 255
        required: true
      - name: slug
        type: string
        max_length: 255
        required: true
        unique: true
      - name: description
        type: text
        required: false
      - name: status
        type: enum
        enum_values: ["draft", "active", "archived"]
        required: true
        default: "draft"
      - name: created_at
        type: datetime
        required: true
        default: now
      - name: updated_at
        type: datetime
        required: true

  - kind: add_entity
    scope: data
    entity: ProductVariant
    fields:
      - name: id
        type: uuid
        required: true
      - name: product_id
        type: uuid
        required: true
      - name: title
        type: string
        max_length: 255
        required: true
      - name: sku
        type: string
        max_length: 100
        required: false
        unique: true
      - name: price
        type: decimal
        required: true
      - name: compare_at_price
        type: decimal
        required: false
      - name: inventory_quantity
        type: integer
        required: true
        default: 0
      - name: weight
        type: decimal
        required: false
      - name: weight_unit
        type: enum
        enum_values: ["kg", "lb", "oz", "g"]
        required: false
        default: "kg"
      - name: barcode
        type: string
        max_length: 100
        required: false
      - name: created_at
        type: datetime
        required: true
        default: now
      - name: updated_at
        type: datetime
        required: true

  - kind: add_entity
    scope: data
    entity: ProductImage
    fields:
      - name: id
        type: uuid
        required: true
      - name: product_id
        type: uuid
        required: true
      - name: url
        type: string
        max_length: 500
        required: true
      - name: alt_text
        type: string
        max_length: 255
        required: false
      - name: position
        type: integer
        required: true
        default: 0
      - name: created_at
        type: datetime
        required: true
        default: now

  # ============================================
  # CUSTOMER ENTITIES
  # ============================================

  - kind: add_entity
    scope: data
    entity: Customer
    fields:
      - name: id
        type: uuid
        required: true
      - name: email
        type: string
        max_length: 255
        required: true
        unique: true
      - name: first_name
        type: string
        max_length: 255
        required: false
      - name: last_name
        type: string
        max_length: 255
        required: false
      - name: phone
        type: string
        max_length: 50
        required: false
      - name: accepts_marketing
        type: boolean
        required: true
        default: false
      - name: created_at
        type: datetime
        required: true
        default: now
      - name: updated_at
        type: datetime
        required: true

  - kind: add_entity
    scope: data
    entity: Address
    fields:
      - name: id
        type: uuid
        required: true
      - name: customer_id
        type: uuid
        required: true
      - name: first_name
        type: string
        max_length: 255
        required: true
      - name: last_name
        type: string
        max_length: 255
        required: true
      - name: company
        type: string
        max_length: 255
        required: false
      - name: address1
        type: string
        max_length: 500
        required: true
      - name: address2
        type: string
        max_length: 500
        required: false
      - name: city
        type: string
        max_length: 255
        required: true
      - name: province
        type: string
        max_length: 255
        required: true
      - name: country
        type: string
        max_length: 100
        required: true
      - name: zip
        type: string
        max_length: 20
        required: true
      - name: phone
        type: string
        max_length: 50
        required: false
      - name: is_default
        type: boolean
        required: true
        default: false
      - name: created_at
        type: datetime
        required: true
        default: now
      - name: updated_at
        type: datetime
        required: true

  # ============================================
  # ORDER ENTITIES
  # ============================================

  - kind: add_entity
    scope: data
    entity: Order
    fields:
      - name: id
        type: uuid
        required: true
      - name: order_number
        type: string
        max_length: 50
        required: true
        unique: true
      - name: customer_id
        type: uuid
        required: false
      - name: email
        type: string
        max_length: 255
        required: true
      - name: financial_status
        type: enum
        enum_values: ["pending", "authorized", "partially_paid", "paid", "partially_refunded", "refunded", "voided"]
        required: true
        default: "pending"
      - name: fulfillment_status
        type: enum
        enum_values: ["unfulfilled", "partial", "fulfilled", "restocked"]
        required: true
        default: "unfulfilled"
      - name: subtotal_price
        type: decimal
        required: true
      - name: total_tax
        type: decimal
        required: true
        default: 0
      - name: total_discounts
        type: decimal
        required: true
        default: 0
      - name: total_price
        type: decimal
        required: true
      - name: currency
        type: string
        max_length: 3
        required: true
        default: "USD"
      - name: shipping_address_id
        type: uuid
        required: false
      - name: billing_address_id
        type: uuid
        required: false
      - name: created_at
        type: datetime
        required: true
        default: now
      - name: updated_at
        type: datetime
        required: true

  - kind: add_entity
    scope: data
    entity: OrderItem
    fields:
      - name: id
        type: uuid
        required: true
      - name: order_id
        type: uuid
        required: true
      - name: product_variant_id
        type: uuid
        required: true
      - name: title
        type: string
        max_length: 255
        required: true
      - name: quantity
        type: integer
        required: true
      - name: price
        type: decimal
        required: true
      - name: sku
        type: string
        max_length: 100
        required: false
      - name: created_at
        type: datetime
        required: true
        default: now

  # ============================================
  # CART ENTITIES
  # ============================================

  - kind: add_entity
    scope: data
    entity: Cart
    fields:
      - name: id
        type: uuid
        required: true
      - name: customer_id
        type: uuid
        required: false
      - name: session_id
        type: string
        max_length: 255
        required: false
      - name: created_at
        type: datetime
        required: true
        default: now
      - name: updated_at
        type: datetime
        required: true

  - kind: add_entity
    scope: data
    entity: CartItem
    fields:
      - name: id
        type: uuid
        required: true
      - name: cart_id
        type: uuid
        required: true
      - name: product_variant_id
        type: uuid
        required: true
      - name: quantity
        type: integer
        required: true
      - name: created_at
        type: datetime
        required: true
        default: now
      - name: updated_at
        type: datetime
        required: true

  # ============================================
  # RELATIONSHIPS
  # ============================================

  # Product -> ProductVariant (one-to-many)
  - kind: add_relation
    scope: data
    relation:
      source_entity: ProductVariant
      target_entity: Product
      kind: many_to_one
      field_name: product
      foreign_key:
        local_field: product_id
        target_field: id
      reverse:
        kind: one_to_many
        field_name: variants

  # Product -> ProductImage (one-to-many)
  - kind: add_relation
    scope: data
    relation:
      source_entity: ProductImage
      target_entity: Product
      kind: many_to_one
      field_name: product
      foreign_key:
        local_field: product_id
        target_field: id
      reverse:
        kind: one_to_many
        field_name: images

  # Product <-> Category (many-to-many)
  - kind: add_relation
    scope: data
    relation:
      source_entity: Product
      target_entity: Category
      kind: many_to_many
      field_name: categories

  # Customer -> Order (one-to-many)
  - kind: add_relation
    scope: data
    relation:
      source_entity: Order
      target_entity: Customer
      kind: many_to_one
      field_name: customer
      foreign_key:
        local_field: customer_id
        target_field: id
      reverse:
        kind: one_to_many
        field_name: orders

  # Customer -> Address (one-to-many)
  - kind: add_relation
    scope: data
    relation:
      source_entity: Address
      target_entity: Customer
      kind: many_to_one
      field_name: customer
      foreign_key:
        local_field: customer_id
        target_field: id
      reverse:
        kind: one_to_many
        field_name: addresses

  # Order -> OrderItem (one-to-many)
  - kind: add_relation
    scope: data
    relation:
      source_entity: OrderItem
      target_entity: Order
      kind: many_to_one
      field_name: order
      foreign_key:
        local_field: order_id
        target_field: id
      reverse:
        kind: one_to_many
        field_name: items

  # OrderItem -> ProductVariant (many-to-one)
  - kind: add_relation
    scope: data
    relation:
      source_entity: OrderItem
      target_entity: ProductVariant
      kind: many_to_one
      field_name: product_variant
      foreign_key:
        local_field: product_variant_id
        target_field: id

  # Order -> Address (shipping address)
  - kind: add_relation
    scope: data
    relation:
      source_entity: Order
      target_entity: Address
      kind: many_to_one
      field_name: shipping_address
      foreign_key:
        local_field: shipping_address_id
        target_field: id

  # Order -> Address (billing address)
  - kind: add_relation
    scope: data
    relation:
      source_entity: Order
      target_entity: Address
      kind: many_to_one
      field_name: billing_address
      foreign_key:
        local_field: billing_address_id
        target_field: id

  # Customer -> Cart (one-to-one)
  - kind: add_relation
    scope: data
    relation:
      source_entity: Cart
      target_entity: Customer
      kind: many_to_one
      field_name: customer
      foreign_key:
        local_field: customer_id
        target_field: id

  # Cart -> CartItem (one-to-many)
  - kind: add_relation
    scope: data
    relation:
      source_entity: CartItem
      target_entity: Cart
      kind: many_to_one
      field_name: cart
      foreign_key:
        local_field: cart_id
        target_field: id
      reverse:
        kind: one_to_many
        field_name: items

  # CartItem -> ProductVariant (many-to-one)
  - kind: add_relation
    scope: data
    relation:
      source_entity: CartItem
      target_entity: ProductVariant
      kind: many_to_one
      field_name: product_variant
      foreign_key:
        local_field: product_variant_id
        target_field: id

  # ============================================
  # PRODUCT APIs
  # ============================================

  - kind: add_endpoint
    scope: api
    method: GET
    description: Get all products with pagination
    path: /api/products
    entity: Product

  - kind: add_endpoint
    scope: api
    method: GET
    description: Get a product by id
    path: /api/products/{id}
    entity: Product

  - kind: add_endpoint
    scope: api
    method: GET
    description: Get a product by slug
    path: /api/products/slug/{slug}
    entity: Product

  - kind: add_endpoint
    scope: api
    method: POST
    description: Create a new product
    path: /api/products
    entity: Product

  - kind: add_endpoint
    scope: api
    method: PUT
    description: Update a product by id
    path: /api/products/{id}
    entity: Product

  - kind: add_endpoint
    scope: api
    method: DELETE
    description: Delete a product by id
    path: /api/products/{id}
    entity: Product

  # Product Variants
  - kind: add_endpoint
    scope: api
    method: GET
    description: Get all variants for a product
    path: /api/products/{id}/variants
    entity: ProductVariant

  - kind: add_endpoint
    scope: api
    method: POST
    description: Create a product variant
    path: /api/products/{id}/variants
    entity: ProductVariant

  - kind: add_endpoint
    scope: api
    method: PUT
    description: Update a product variant
    path: /api/variants/{id}
    entity: ProductVariant

  - kind: add_endpoint
    scope: api
    method: DELETE
    description: Delete a product variant
    path: /api/variants/{id}
    entity: ProductVariant

  # Product Images
  - kind: add_endpoint
    scope: api
    method: GET
    description: Get all images for a product
    path: /api/products/{id}/images
    entity: ProductImage

  - kind: add_endpoint
    scope: api
    method: POST
    description: Add an image to a product
    path: /api/products/{id}/images
    entity: ProductImage

  - kind: add_endpoint
    scope: api
    method: DELETE
    description: Delete a product image
    path: /api/images/{id}
    entity: ProductImage

  # Categories
  - kind: add_endpoint
    scope: api
    method: GET
    description: Get all categories
    path: /api/categories
    entity: Category

  - kind: add_endpoint
    scope: api
    method: GET
    description: Get a category by id
    path: /api/categories/{id}
    entity: Category

  - kind: add_endpoint
    scope: api
    method: GET
    description: Get products in a category
    path: /api/categories/{id}/products
    entity: Product

  - kind: add_endpoint
    scope: api
    method: POST
    description: Create a new category
    path: /api/categories
    entity: Category

  - kind: add_endpoint
    scope: api
    method: PUT
    description: Update a category
    path: /api/categories/{id}
    entity: Category

  - kind: add_endpoint
    scope: api
    method: DELETE
    description: Delete a category
    path: /api/categories/{id}
    entity: Category

  # ============================================
  # CUSTOMER APIs
  # ============================================

  - kind: add_endpoint
    scope: api
    method: GET
    description: Get all customers
    path: /api/customers
    entity: Customer

  - kind: add_endpoint
    scope: api
    method: GET
    description: Get a customer by id
    path: /api/customers/{id}
    entity: Customer

  - kind: add_endpoint
    scope: api
    method: POST
    description: Create a new customer
    path: /api/customers
    entity: Customer

  - kind: add_endpoint
    scope: api
    method: PUT
    description: Update a customer
    path: /api/customers/{id}
    entity: Customer

  - kind: add_endpoint
    scope: api
    method: DELETE
    description: Delete a customer
    path: /api/customers/{id}
    entity: Customer

  # Customer Addresses
  - kind: add_endpoint
    scope: api
    method: GET
    description: Get all addresses for a customer
    path: /api/customers/{id}/addresses
    entity: Address

  - kind: add_endpoint
    scope: api
    method: POST
    description: Add an address to a customer
    path: /api/customers/{id}/addresses
    entity: Address

  - kind: add_endpoint
    scope: api
    method: PUT
    description: Update a customer address
    path: /api/addresses/{id}
    entity: Address

  - kind: add_endpoint
    scope: api
    method: DELETE
    description: Delete a customer address
    path: /api/addresses/{id}
    entity: Address

  # ============================================
  # ORDER APIs
  # ============================================

  - kind: add_endpoint
    scope: api
    method: GET
    description: Get all orders
    path: /api/orders
    entity: Order

  - kind: add_endpoint
    scope: api
    method: GET
    description: Get orders for a customer
    path: /api/customers/{id}/orders
    entity: Order

  - kind: add_endpoint
    scope: api
    method: GET
    description: Get an order by id
    path: /api/orders/{id}
    entity: Order

  - kind: add_endpoint
    scope: api
    method: GET
    description: Get an order by order number
    path: /api/orders/number/{order_number}
    entity: Order

  - kind: add_endpoint
    scope: api
    method: POST
    description: Create a new order
    path: /api/orders
    entity: Order

  - kind: add_endpoint
    scope: api
    method: PUT
    description: Update an order
    path: /api/orders/{id}
    entity: Order

  # ============================================
  # CART APIs
  # ============================================

  - kind: add_endpoint
    scope: api
    method: GET
    description: Get cart by customer id or session id
    path: /api/cart
    entity: Cart

  - kind: add_endpoint
    scope: api
    method: POST
    description: Create or get cart
    path: /api/cart
    entity: Cart

  - kind: add_endpoint
    scope: api
    method: POST
    description: Add item to cart
    path: /api/cart/items
    entity: CartItem

  - kind: add_endpoint
    scope: api
    method: PUT
    description: Update cart item quantity
    path: /api/cart/items/{id}
    entity: CartItem

  - kind: add_endpoint
    scope: api
    method: DELETE
    description: Remove item from cart
    path: /api/cart/items/{id}
    entity: CartItem

  - kind: add_endpoint
    scope: api
    method: POST
    description: Checkout cart and create order
    path: /api/cart/checkout
    entity: Order
