version: 0.1.0
type: oiml.summary
intent_id: FEAT-1
intent_file: .openintent/intents/FEAT-1/intent.yaml
applied_at: "2025-11-18T21:00:00Z"
status: success

summary: |
  Successfully applied email capability using Resend to the Next.js application.
  Added complete email infrastructure including API endpoints, utilities, type definitions, and webhook handling.

intents_applied:
  - kind: add_capability
    scope: capability
    capability: email
    framework: next
    provider: resend
    status: success
    description: Integrated Resend email service with transactional email support, batch sending, and webhook handling

changes:
  files_created:
    - path: lib/email.ts
      description: |
        Resend client configuration and email utility functions including:
        - sendEmail() for single email sending
        - sendBatchEmails() for batch email operations
        - EmailTemplates for common email use cases (welcome, password reset, notification)
        - Type-safe interfaces and comprehensive error handling
      lines_added: 237

    - path: app/api/email/send/route.ts
      description: |
        POST /api/email/send endpoint for sending single transactional emails.
        Supports HTML, text, React components, multiple recipients, tags, and scheduled sending.
      lines_added: 93

    - path: app/api/email/batch/route.ts
      description: |
        POST /api/email/batch endpoint for sending multiple emails efficiently in a batch.
        Includes per-email validation with detailed error messages.
      lines_added: 89

    - path: app/api/email/webhook/route.ts
      description: |
        POST /api/email/webhook endpoint for handling Resend webhook events.
        Supports events: sent, delivered, delivery_delayed, bounced, complained, opened, clicked.
      lines_added: 125

    - path: types/email.ts
      description: |
        Type definitions for email operations including:
        - Request/response interfaces for all endpoints
        - Webhook event types and structures
        - Email status tracking types for database integration
      lines_added: 118

  files_modified: []

  dependencies:
    already_installed:
      - name: resend
        version: "^6.5.0"
        description: Resend SDK for email delivery

    recommended:
      - name: "@react-email/components"
        purpose: Create beautiful, responsive email templates with React
        install_command: "npm install @react-email/components @react-email/render -D"

configuration:
  environment_variables:
    required:
      - name: RESEND_API_KEY
        description: Resend API key for authentication
        example: "re_your_api_key_here"
        docs: "https://resend.com/api-keys"

    optional:
      - name: FROM_EMAIL
        description: Default sender email address (must be verified in Resend)
        example: "noreply@yourdomain.com"

      - name: FROM_NAME
        description: Default sender name
        example: "Your App"

      - name: RESEND_WEBHOOK_SECRET
        description: Webhook signing secret for verifying webhook signatures
        example: "whsec_your_secret_here"
        docs: "https://resend.com/docs/dashboard/webhooks/verify-signature"

  resend_dashboard_setup:
    - step: 1
      action: "Sign up / Log in to Resend at https://resend.com"
    - step: 2
      action: "Add and verify your domain in Resend Dashboard → Domains"
    - step: 3
      action: "Create an API key in Resend Dashboard → API Keys"
    - step: 4
      action: "Add API key to .env.local as RESEND_API_KEY"
    - step: 5
      action: "(Optional) Set up webhooks in Resend Dashboard → Webhooks"
      details: "Add webhook URL: https://yourdomain.com/api/email/webhook"

api_endpoints:
  - method: POST
    path: /api/email/send
    description: Send a single transactional email
    request_body:
      to: string | string[]
      subject: string
      html?: string
      text?: string
      from?: string
      replyTo?: string
      cc?: string | string[]
      bcc?: string | string[]
      tags?: Array<{ name: string, value: string }>
      scheduledAt?: string
    response:
      success: true
      data:
        id: string
        message: string

  - method: POST
    path: /api/email/batch
    description: Send multiple emails in a batch
    request_body:
      emails: Array<{
        to: string | string[],
        subject: string,
        html?: string,
        text?: string,
        from?: string,
        replyTo?: string
      }>
    response:
      success: true
      data:
        ids: string[]
        message: string

  - method: POST
    path: /api/email/webhook
    description: Handle Resend webhook events
    webhook_events:
      - email.sent
      - email.delivered
      - email.delivery_delayed
      - email.bounced
      - email.complained
      - email.opened
      - email.clicked

usage_examples:
  - name: Send a welcome email
    code: |
      // From your application code
      const response = await fetch('/api/email/send', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          to: 'user@example.com',
          subject: 'Welcome to our app!',
          html: '<p>Thanks for signing up!</p>'
        })
      });
      const result = await response.json();
      console.log('Email sent:', result.data.id);

  - name: Send batch emails
    code: |
      const response = await fetch('/api/email/batch', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          emails: [
            { to: 'user1@example.com', subject: 'Hello', html: '<p>Hi User 1</p>' },
            { to: 'user2@example.com', subject: 'Hello', html: '<p>Hi User 2</p>' }
          ]
        })
      });

  - name: Use email utility directly in server components
    code: |
      // In a server component or API route
      import { sendEmail, EmailTemplates } from '@/lib/email';

      await sendEmail({
        to: 'user@example.com',
        subject: 'Welcome!',
        html: EmailTemplates.welcome('John Doe', 'https://app.example.com/login')
      });

next_steps:
  - Configure RESEND_API_KEY in .env.local
  - Verify your domain in Resend Dashboard
  - Test email sending using the /api/email/send endpoint
  - (Optional) Set up React Email for custom templates
  - (Optional) Configure webhooks for email event tracking
  - (Optional) Add email tracking to your database using the webhook endpoint

template_info:
  template_pack: oiml-email-resend-next
  version: 1.0.0
  guide: packages/schema/templates/capability/email/next/1.0.0/AGENTS.md

compatibility:
  next_version: 16.0.1
  resend_version: 6.5.0
  version: 0.1.0

notes: |
  - Resend requires domain verification for production email sending
  - Development emails can be sent to verified addresses without domain verification
  - For React Email templates, install @react-email/components (recommended but optional)
  - Webhook signature verification is commented out but recommended for production
  - All email operations are fully typed with TypeScript for type safety
  - Email templates in lib/email.ts are basic examples; use React Email for production

references:
  - https://resend.com/docs/introduction
  - https://resend.com/docs/send-with-nextjs
  - https://resend.com/docs/dashboard/webhooks/introduction
  - https://react.email

